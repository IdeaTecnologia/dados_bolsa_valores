name: Atualizar A√ß√µes Diariamente

on:
  schedule:
    - cron: '0 23 * * *'  # 20h no hor√°rio de Bras√≠lia (UTC-3)
  workflow_dispatch:      # Permite acionar manualmente

jobs:
  update:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"


      - name: Set up Node.js for cloudscraper
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      # Instala√ßao de depend√™ncias
      - name: Install dependencies
        run: pip install -r requirements.txt

      # Executa o script de atualiza√ß√£o
      - name: Run Scraper
        run: python main.py

      # Commit and push altera√ß√µes no reposit√≥rio
      - name: Commit and push changes
        run: |
          # Configura o usu√°rio do Git para o bot da Action
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions-bot@github.com"
          
          # Adiciona o arquivo de dados para ser verificado
          git add dados_acoes.json
          
          # Verifica se h√° mudan√ßas no arquivo. Se houver, faz o commit e o push.
          # Isso evita commits vazios e erros caso o arquivo n√£o seja alterado.
          if ! git diff-index --quiet HEAD; then
            git commit -m "üìä Atualiza√ß√£o autom√°tica dos dados das a√ß√µes ($(date +'%d/%m/%Y %H:%M'))"
            git push
          else
            echo "Nenhuma mudan√ßa nos dados das a√ß√µes para commitar."
          fi
